<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrowserUse Agent åˆ—è¡¨</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <link rel="stylesheet" href="/static/css/index.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ–¥ï¸ BrowserUse Agent åˆ—è¡¨</h1>
        
        <div class="sessions" id="sessions">
        </div>
    </div>
    
    <button class="refresh-btn" id="refresh-btn" title="åˆ·æ–° Sandbox åˆ—è¡¨">
        ğŸ”„
    </button>
    
    <script>
        let isLoading = false;
        
        async function loadSessions() {
            if (isLoading) return;
            
            isLoading = true;
            const refreshBtn = document.getElementById('refresh-btn');
            refreshBtn.classList.add('loading');
            
            try {
                // âœ… æ›´æ–°ï¼šä½¿ç”¨æ–°çš„ API æ¥å£
                const response = await fetch('/api/sandboxes');
                const sandboxes = await response.json();
                
                const container = document.getElementById('sessions');
                
                // âœ… æ›´æ–°ï¼šç›´æ¥ä½¿ç”¨æ•°ç»„ï¼ˆä¸æ˜¯ data.sessionsï¼‰
                if (!sandboxes || sandboxes.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <h2>æš‚æ— æ´»è·ƒ Agent</h2>
                            <p>Agent å°†å‡ºç°åœ¨è¿™é‡Œ</p>
                        </div>
                    `;
                } else {
                    container.innerHTML = '';
                    
                    // âœ… æ›´æ–°ï¼šä½¿ç”¨ sandboxes æ•°ç»„å’Œ sandbox å¯¹è±¡
                    sandboxes.forEach(sandbox => {
                        const card = document.createElement('div');
                        card.className = 'session-card';
                        
                        // âœ… æ›´æ–°ï¼šä½¿ç”¨æ–°çš„å­—æ®µå
                        const lastActivity = sandbox.last_access_at 
                            ? new Date(sandbox.last_access_at * 1000).toLocaleString('zh-CN')
                            : 'N/A';
                        
                        card.innerHTML = `
                            <h3>${sandbox.sandbox_id}</h3>
                            <p><strong>CDP URL:</strong> ${sandbox.cdp_url ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®'}</p>
                            <p><strong>VNC URL:</strong> ${sandbox.vnc_url ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®'}</p>
                            <p><strong>æ—¥å¿—æ•°:</strong> ${sandbox.log_count || 0}</p>
                            <p><strong>æœ€åè®¿é—®:</strong> ${lastActivity}</p>
                            <a href="/viewer/${sandbox.sandbox_id}">æŸ¥çœ‹è¯¦æƒ… â†’</a>
                        `;
                        container.appendChild(card);
                    });
                }
            } catch (error) {
                console.error('åŠ è½½ Sandbox åˆ—è¡¨å¤±è´¥:', error);
                const container = document.getElementById('sessions');
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <h2>âš ï¸ åŠ è½½å¤±è´¥</h2>
                        <p>æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿ VNC Manager Server æ­£åœ¨è¿è¡Œ</p>
                        <p style="color: #999; font-size: 0.9em;">é”™è¯¯ä¿¡æ¯: ${error.message}</p>
                    </div>
                `;
            } finally {
                isLoading = false;
                refreshBtn.classList.remove('loading');
            }
        }
        
        // åˆå§‹åŠ è½½
        loadSessions();
        
        // å®šæ—¶åˆ·æ–°ï¼ˆæ¯ 5 ç§’ï¼‰
        setInterval(loadSessions, 5000);
        
        // åˆ·æ–°æŒ‰é’®
        document.getElementById('refresh-btn').addEventListener('click', loadSessions);
    </script>
</body>
</html>

